<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessible Typing Tutor</title>
    <style>
        :root {
            --base-font-size: 24px;
            --bg-color: #000000;
            --container-bg: #222222;
            --text-color: #FFFFFF;
            --accent-color: #FFA500;
            --border-color: #444444;
            --button-bg: #333333;
            --button-hover: #444444;
            --checkbox-bg: #333333;
            --checkbox-checked: #666666;
            --correct-color: #00AA00;
            --incorrect-color: #AA0000;
            --focus-color: #FFFF00;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            padding: 20px;
            min-height: 100vh;
            font-size: var(--base-font-size);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--container-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-weight: bold;
            color: var(--text-color);
            font-size: calc(var(--base-font-size) * 2);
        }
        
        h2 {
            font-size: calc(var(--base-font-size) * 1.5);
            margin-bottom: 20px;
        }
        
        h3 {
            font-size: calc(var(--base-font-size) * 1.33);
            margin-bottom: 15px;
        }
        
        .disclaimer {
            background-color: #333333;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 35px;
            font-size: calc(var(--base-font-size) * 1.17);
            border-left: 6px solid var(--accent-color);
        }
        
        .progress-container {
            width: 100%;
            background-color: #333333;
            border-radius: 6px;
            margin-bottom: 35px;
            overflow: hidden;
            height: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .section {
            display: none;
            margin-bottom: 30px;
        }
        
        .section.active {
            display: block;
        }
        
        .section-title {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--border-color);
            color: var(--text-color);
        }
        
        .lesson-objective {
            background-color: #333333;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 6px solid var(--accent-color);
            font-size: calc(var(--base-font-size) * 1.17);
        }
        
        /* UPDATED: Finger map now floats side by side */
        .finger-map {
            display: flex;
            flex-wrap: nowrap;
            justify-content: space-between;
            gap: 15px;
            margin: 30px 0;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .finger-column {
            background-color: #333333;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            min-width: 200px;
        }
        
        .finger-name {
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--text-color);
            font-size: calc(var(--base-font-size) * 1.33);
        }
        
        .key-path {
            font-size: calc(var(--base-font-size) * 1.5);
            margin: 15px 0;
            font-weight: bold;
        }
        
        .mnemonic {
            font-style: italic;
            color: #CCCCCC;
            font-size: calc(var(--base-font-size) * 1.17);
        }
        
        .drill-container {
            background-color: #333333;
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
        }
        
        .drill-title {
            margin-bottom: 25px;
            color: var(--text-color);
        }
        
        .phrase-to-type {
            font-size: calc(var(--base-font-size) * 1.5);
            background-color: #2a2a2a;
            padding: 25px;
            border-radius: 6px;
            margin: 25px 0;
            text-align: center;
            letter-spacing: 3px;
            border: 3px solid var(--border-color);
            font-weight: bold;
        }
        
        .typing-area {
            width: 100%;
            background-color: #2a2a2a;
            color: var(--text-color);
            border: 3px solid var(--border-color);
            border-radius: 6px;
            padding: 25px;
            font-size: calc(var(--base-font-size) * 1.33);
            resize: vertical;
            min-height: 150px;
            margin: 25px 0;
        }
        
        .typing-area:focus {
            outline: none;
            border-color: var(--focus-color);
            box-shadow: 0 0 10px var(--focus-color);
        }
        
        .feedback {
            margin: 25px 0;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            font-size: calc(var(--base-font-size) * 1.33);
        }
        
        .feedback.correct {
            background-color: var(--correct-color);
            color: #000000;
        }
        
        .feedback.incorrect {
            background-color: var(--incorrect-color);
            color: #FFFFFF;
        }
        
        .completion-criteria {
            background-color: #333333;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 6px solid var(--accent-color);
            font-size: calc(var(--base-font-size) * 1.17);
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }
        
        button {
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 3px solid var(--border-color);
            padding: 20px 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: calc(var(--base-font-size) * 1.17);
            font-weight: bold;
        }
        
        button:hover, button:focus {
            background-color: var(--button-hover);
            outline: 3px solid var(--focus-color);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .keyboard-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }
        
        .keyboard-row {
            display: flex;
            margin-bottom: 15px;
        }
        
        .key {
            width: 70px;
            height: 70px;
            background-color: #333333;
            border: 3px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 5px;
            font-size: calc(var(--base-font-size) * 1.17);
            font-weight: bold;
        }
        
        .key.wide {
            width: 140px;
        }
        
        .key.extra-wide {
            width: 210px;
        }
        
        .key.home {
            background-color: #444444;
        }
        
        .key.active {
            background-color: var(--accent-color);
            color: #000000;
        }
        
        .instructions {
            background-color: #333333;
            padding: 25px;
            border-radius: 8px;
            margin: 25px 0;
            font-size: calc(var(--base-font-size) * 1.17);
        }
        
        .instructions ul, .instructions ol {
            padding-left: 40px;
        }
        
        .instructions li {
            margin-bottom: 15px;
        }
        
        .mantra {
            text-align: center;
            font-style: italic;
            margin: 30px 0;
            padding: 20px;
            background-color: #333333;
            border-radius: 8px;
            font-size: calc(var(--base-font-size) * 1.33);
        }
        
        .two-hand-map {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .hand-section {
            background-color: #333333;
            padding: 25px;
            border-radius: 8px;
        }
        
        .hand-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: calc(var(--base-font-size) * 1.33);
        }
        
        .accessibility-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .accessibility-button {
            background-color: #333333;
            color: var(--text-color);
            border: 3px solid var(--border-color);
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: calc(var(--base-font-size) * 1);
        }
        
        .accessibility-button:hover, .accessibility-button:focus {
            background-color: #444444;
            outline: 3px solid var(--focus-color);
        }
        
        .font-size-display {
            text-align: center;
            font-size: calc(var(--base-font-size) * 1.17);
            margin: 10px 0;
            font-weight: bold;
        }
        
        /* Custom additions for the typing tutor */
        .typing-tutor-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .key.pinky { border-color: #e53e3e; }
        .key.ring { border-color: #dd6b20; }
        .key.middle { border-color: #d69e2e; }
        .key.index-left { border-color: #38a169; }
        .key.index-right { border-color: #319795; }
        .key.thumb { border-color: #805ad5; }
        
        .key.active.pinky { background-color: #e53e3e; }
        .key.active.ring { background-color: #dd6b20; }
        .key.active.middle { background-color: #d69e2e; }
        .key.active.index-left { background-color: #38a169; }
        .key.active.index-right { background-color: #319795; }
        .key.active.thumb { background-color: #805ad5; }
        
        .practice-stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin: 20px 0;
            padding: 20px;
            background-color: #333333;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: calc(var(--base-font-size) * 1.5);
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .practice-text {
            width: 100%;
            min-height: 150px;
            background-color: #2a2a2a;
            border: 3px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-size: calc(var(--base-font-size) * 1.17);
            resize: vertical;
        }
        
        .practice-text:focus {
            outline: none;
            border-color: var(--focus-color);
            box-shadow: 0 0 10px var(--focus-color);
        }
        
        .voice-feedback {
            margin-top: 20px;
            padding: 15px;
            background-color: #333333;
            border-radius: 8px;
            text-align: center;
            font-size: calc(var(--base-font-size) * 1.17);
        }
        
        @media (max-width: 768px) {
            :root {
                --base-font-size: 20px;
            }
            
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            .key {
                width: 50px;
                height: 50px;
            }
            
            .key.wide {
                width: 100px;
            }
            
            .key.extra-wide {
                width: 150px;
            }
            
            .two-hand-map {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .navigation button {
                width: 100%;
            }
            
            /* On mobile, allow finger map to scroll horizontally */
            .finger-map {
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
            }
            
            .finger-column {
                flex: 0 0 auto;
                min-width: 180px;
            }
        }
        
        @media (max-width: 480px) {
            :root {
                --base-font-size: 18px;
            }
            
            .key {
                width: 40px;
                height: 40px;
            }
            
            .key.wide {
                width: 80px;
            }
            
            .key.extra-wide {
                width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Accessible Typing Tutor</h1>
        
        <div class="disclaimer">
            <p>This typing tutor is designed specifically for users with light sensitivity and low vision. It features high contrast, large text, and clear visual feedback.</p>
        </div>
        
        <div class="accessibility-controls">
            <button class="accessibility-button" id="increaseFont">Increase Font Size</button>
            <button class="accessibility-button" id="decreaseFont">Decrease Font Size</button>
            <button class="accessibility-button" id="toggleVoice">Toggle Voice Feedback</button>
            <button class="accessibility-button" id="toggleHighContrast">Toggle High Contrast</button>
        </div>
        
        <div class="font-size-display">
            Current Font Size: <span id="currentFontSize">24px</span>
        </div>
        
        <div class="typing-tutor-container">
            <div class="practice-stats">
                <div class="stat-item">
                    <div class="stat-value" id="keysPracticed">0</div>
                    <div>Keys Practiced</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracy">0%</div>
                    <div>Accuracy</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="sessionTime">0:00</div>
                    <div>Session Time</div>
                </div>
            </div>
            
            <div class="keyboard-visual">
                <h2>Complete Keyboard</h2>
                
                <!-- Number Row -->
                <div class="keyboard-row">
                    <div class="key pinky" data-key="`">`</div>
                    <div class="key pinky" data-key="1">1</div>
                    <div class="key ring" data-key="2">2</div>
                    <div class="key middle" data-key="3">3</div>
                    <div class="key index-left" data-key="4">4</div>
                    <div class="key index-left" data-key="5">5</div>
                    <div class="key index-right" data-key="6">6</div>
                    <div class="key index-right" data-key="7">7</div>
                    <div class="key middle" data-key="8">8</div>
                    <div class="key ring" data-key="9">9</div>
                    <div class="key pinky" data-key="0">0</div>
                    <div class="key pinky" data-key="-">-</div>
                    <div class="key pinky" data-key="=">=</div>
                    <div class="key pinky wide" data-key="Backspace">⌫</div>
                </div>
                
                <!-- Top Row -->
                <div class="keyboard-row">
                    <div class="key pinky" data-key="Q">Q</div>
                    <div class="key ring" data-key="W">W</div>
                    <div class="key middle" data-key="E">E</div>
                    <div class="key index-left" data-key="R">R</div>
                    <div class="key index-left" data-key="T">T</div>
                    <div class="key index-right" data-key="Y">Y</div>
                    <div class="key index-right" data-key="U">U</div>
                    <div class="key middle" data-key="I">I</div>
                    <div class="key ring" data-key="O">O</div>
                    <div class="key pinky" data-key="P">P</div>
                    <div class="key pinky" data-key="[">[</div>
                    <div class="key pinky" data-key="]">]</div>
                    <div class="key pinky" data-key="\\">\\</div>
                </div>
                
                <!-- Home Row -->
                <div class="keyboard-row">
                    <div class="key pinky home" data-key="A">A</div>
                    <div class="key ring home" data-key="S">S</div>
                    <div class="key middle home" data-key="D">D</div>
                    <div class="key index-left home" data-key="F">F</div>
                    <div class="key index-left home" data-key="G">G</div>
                    <div class="key index-right home" data-key="H">H</div>
                    <div class="key index-right home" data-key="J">J</div>
                    <div class="key middle home" data-key="K">K</div>
                    <div class="key ring home" data-key="L">L</div>
                    <div class="key pinky" data-key=";">;</div>
                    <div class="key pinky" data-key="'">'</div>
                    <div class="key pinky wide" data-key="Enter">⏎</div>
                </div>
                
                <!-- Bottom Row -->
                <div class="keyboard-row">
                    <div class="key pinky" data-key="Z">Z</div>
                    <div class="key ring" data-key="X">X</div>
                    <div class="key middle" data-key="C">C</div>
                    <div class="key index-left" data-key="V">V</div>
                    <div class="key index-left" data-key="B">B</div>
                    <div class="key index-right" data-key="N">N</div>
                    <div class="key index-right" data-key="M">M</div>
                    <div class="key middle" data-key=",">,</div>
                    <div class="key ring" data-key=".">.</div>
                    <div class="key pinky" data-key="/">/</div>
                </div>
                
                <!-- Space Bar Row -->
                <div class="keyboard-row">
                    <div class="key thumb extra-wide" data-key=" ">Space</div>
                </div>
            </div>
            
            <!-- UPDATED: Finger map with complete mnemonics -->
            <div class="finger-map">
                <div class="finger-column">
                    <div class="finger-name">Pinky Finger</div>
                    <div class="key-path">` 1 0 - =<br>Q A Z <br>P ; / <br>[ ] \ ' </div>
                    <div class="mnemonic">Quick Access Zone<br>Put Semi Slash</div>
                </div>
                <div class="finger-column">
                    <div class="finger-name">Ring Finger</div>
                    <div class="key-path">2 9 <br>W S X <br>O L .</div>
                    <div class="mnemonic">Whisper Secret X<br>Only Large Period</div>
                </div>
                <div class="finger-column">
                    <div class="finger-name">Middle Finger</div>
                    <div class="key-path">3 8<br>E D C <br>I K ,</div>
                    <div class="mnemonic">Every Dime Counts<br>Insert Key Comma</div>
                </div>
                <div class="finger-column">
                    <div class="finger-name">Left Index</div>
                    <div class="key-path">4 5 <br>R F V <br>T G B</div>
                    <div class="mnemonic">Really Fast View<br>To Get Better</div>
                </div>
                <div class="finger-column">
                    <div class="finger-name">Right Index</div>
                    <div class="key-path">6 7 <br>Y H N <br>U J M</div>
                    <div class="mnemonic">Your Home Now<br>Upon Just Moving</div>
                </div>
                <div class="finger-column">
                    <div class="finger-name">Thumbs</div>
                    <div class="key-path">Space</div>
                    <div class="mnemonic">Space Bar</div>
                </div>
            </div>
            
            <div class="practice-text" id="practiceText" contenteditable="true" placeholder="Start typing here to practice..."></div>
            
            <div class="voice-feedback" id="voiceFeedback">
                Voice feedback: <span id="feedbackText">Click any key to begin</span>
            </div>
            
            <div class="navigation">
                <button id="resetStats">Reset Statistics</button>
                <button id="speakInstructions">Repeat Instructions</button>
            </div>

            <div class="instructions">
                <h3>How to Use This Tutor:</h3>
                <ol>
                    <li>Click any key on the virtual keyboard or type on your physical keyboard</li>
                    <li>The app will speak the finger and letter name (if voice feedback is enabled)</li>
                    <li>Colors show which finger to use for each key</li>
                    <li>Practice regularly to build muscle memory</li>
                    <li>Use the accessibility controls to adjust the interface to your needs</li>
                    <li>Practice Enter, Backspace, numbers, and Space to master all essential keys</li>
                </ol>
            </div>
            
        </div>
    </div>

    <script>
        // Extended finger mapping with numbers and special keys
        const fingerMap = {
            // Numbers and top symbols
            '`': {finger: 'pinky', mnemonic: 'Backtick'},
            '1': {finger: 'pinky', mnemonic: 'One'},
            '2': {finger: 'ring', mnemonic: 'Two'},
            '3': {finger: 'middle', mnemonic: 'Three'},
            '4': {finger: 'index left', mnemonic: 'Four'},
            '5': {finger: 'index left', mnemonic: 'Five'},
            '6': {finger: 'index right', mnemonic: 'Six'},
            '7': {finger: 'index right', mnemonic: 'Seven'},
            '8': {finger: 'middle', mnemonic: 'Eight'},
            '9': {finger: 'ring', mnemonic: 'Nine'},
            '0': {finger: 'pinky', mnemonic: 'Zero'},
            '-': {finger: 'pinky', mnemonic: 'Dash'},
            '=': {finger: 'pinky', mnemonic: 'Equals'},
            
            // Top row letters
            'Q': {finger: 'pinky', mnemonic: 'Quick'},
            'W': {finger: 'ring', mnemonic: 'Whisper'},
            'E': {finger: 'middle', mnemonic: 'Every'},
            'R': {finger: 'index left', mnemonic: 'Really'},
            'T': {finger: 'index left', mnemonic: 'Tiny'},
            'Y': {finger: 'index right', mnemonic: 'Your'},
            'U': {finger: 'index right', mnemonic: 'Use'},
            'I': {finger: 'middle', mnemonic: 'I'},
            'O': {finger: 'ring', mnemonic: 'Open'},
            'P': {finger: 'pinky', mnemonic: 'Please'},
            '[': {finger: 'pinky', mnemonic: 'Left Bracket'},
            ']': {finger: 'pinky', mnemonic: 'Right Bracket'},
            '\\': {finger: 'pinky', mnemonic: 'Backslash'},
            
            // Home row letters
            'A': {finger: 'pinky', mnemonic: 'Access'},
            'S': {finger: 'ring', mnemonic: 'Secret'},
            'D': {finger: 'middle', mnemonic: 'Dog'},
            'F': {finger: 'index left', mnemonic: 'Fast'},
            'G': {finger: 'index left', mnemonic: 'Green'},
            'H': {finger: 'index right', mnemonic: 'Home'},
            'J': {finger: 'index right', mnemonic: 'Jelly'},
            'K': {finger: 'middle', mnemonic: 'Know'},
            'L': {finger: 'ring', mnemonic: 'Level'},
            ';': {finger: 'pinky', mnemonic: 'Semicolon'},
            "'": {finger: 'pinky', mnemonic: 'Apostrophe'},
            
            // Bottom row letters
            'Z': {finger: 'pinky', mnemonic: 'Zone'},
            'X': {finger: 'ring', mnemonic: 'X-rays'},
            'C': {finger: 'middle', mnemonic: 'Can'},
            'V': {finger: 'index left', mnemonic: 'View'},
            'B': {finger: 'index left', mnemonic: 'Box'},
            'N': {finger: 'index right', mnemonic: 'Now'},
            'M': {finger: 'index right', mnemonic: 'Maybe'},
            ',': {finger: 'middle', mnemonic: 'Comma'},
            '.': {finger: 'ring', mnemonic: 'Period'},
            '/': {finger: 'pinky', mnemonic: 'Slash'},
            
            // Special keys
            ' ': {finger: 'thumb', mnemonic: 'Space'},
            'Backspace': {finger: 'pinky', mnemonic: 'Backspace'},
            'Enter': {finger: 'pinky', mnemonic: 'Enter'}
        };

        // Statistics and state
        let keysPracticed = parseInt(localStorage.getItem('keysPracticed')) || 0;
        let correctKeys = parseInt(localStorage.getItem('correctKeys')) || 0;
        let sessionStartTime = new Date();
        let voiceEnabled = localStorage.getItem('voiceEnabled') !== 'false'; // Default to true
        let highContrast = localStorage.getItem('highContrast') === 'true'; // Default to false
        let baseFontSize = parseInt(localStorage.getItem('baseFontSize')) || 24;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            setupEventListeners();
            applyStoredSettings();
            speakWelcome();
        });

        function setupEventListeners() {
            // Virtual keyboard clicks
            document.querySelectorAll('.key').forEach(key => {
                key.addEventListener('click', function() {
                    const keyChar = this.getAttribute('data-key');
                    handleKeyPress(keyChar);
                });
            });

            // Physical keyboard
            document.addEventListener('keydown', function(event) {
                let key = event.key;
                
                // Handle special keys
                if (event.key === 'Enter') {
                    key = 'Enter';
                } else if (event.key === 'Backspace') {
                    key = 'Backspace';
                } else if (event.key === ' ') {
                    key = ' ';
                } else {
                    key = key.toUpperCase();
                }
                
                if (fingerMap[key]) {
                    event.preventDefault();
                    handleKeyPress(key);
                    
                    // For text area, allow the actual typing
                    if (key !== 'Enter' && key !== 'Backspace') {
                        const practiceText = document.getElementById('practiceText');
                        if (key === ' ') {
                            practiceText.textContent += ' ';
                        } else {
                            practiceText.textContent += key;
                        }
                    } else if (key === 'Backspace') {
                        const practiceText = document.getElementById('practiceText');
                        practiceText.textContent = practiceText.textContent.slice(0, -1);
                    } else if (key === 'Enter') {
                        const practiceText = document.getElementById('practiceText');
                        practiceText.textContent += '\n';
                    }
                }
            });

            // Practice text area
            document.getElementById('practiceText').addEventListener('keydown', function(event) {
                let key = event.key;
                
                // Handle special keys
                if (event.key === 'Enter') {
                    key = 'Enter';
                } else if (event.key === 'Backspace') {
                    key = 'Backspace';
                } else if (event.key === ' ') {
                    key = ' ';
                } else {
                    key = key.toUpperCase();
                }
                
                if (fingerMap[key]) {
                    handleKeyPress(key);
                }
            });

            // Accessibility controls
            document.getElementById('increaseFont').addEventListener('click', increaseFontSize);
            document.getElementById('decreaseFont').addEventListener('click', decreaseFontSize);
            document.getElementById('toggleVoice').addEventListener('click', toggleVoice);
            document.getElementById('toggleHighContrast').addEventListener('click', toggleHighContrast);
            document.getElementById('resetStats').addEventListener('click', resetStats);
            document.getElementById('speakInstructions').addEventListener('click', speakInstructions);

            // Update session timer
            setInterval(updateSessionTime, 1000);
        }

        function handleKeyPress(key) {
            // Visual feedback
            highlightKey(key);
            
            // Get finger association
            const fingerData = fingerMap[key];
            const finger = fingerData.finger;
            const mnemonic = fingerData.mnemonic;
            
            // Update statistics
            updateStatistics(key, finger);
            
            // Provide feedback
            let displayKey = key;
            if (key === ' ') displayKey = 'Space';
            if (key === 'Enter') displayKey = 'Enter';
            if (key === 'Backspace') displayKey = 'Backspace';
            
            const feedback = `${finger} ${displayKey}, ${mnemonic}`;
            document.getElementById('feedbackText').textContent = feedback;
            
            // Speak the association
            if (voiceEnabled) {
                speakText(feedback);
            }
        }

        function highlightKey(key) {
            // Remove active class from all keys
            document.querySelectorAll('.key').forEach(k => {
                k.classList.remove('active');
            });
            
            // Add active class to pressed key
            let keyElement;
            if (key === ' ') {
                keyElement = document.querySelector('.key[data-key=" "]');
            } else if (key === 'Enter') {
                keyElement = document.querySelector('.key[data-key="Enter"]');
            } else if (key === 'Backspace') {
                keyElement = document.querySelector('.key[data-key="Backspace"]');
            } else {
                keyElement = document.querySelector(`.key[data-key="${key}"]`);
            }
            
            if (keyElement) {
                keyElement.classList.add('active');
                
                // Remove active class after animation
                setTimeout(() => {
                    keyElement.classList.remove('active');
                }, 500);
            }
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                window.speechSynthesis.speak(utterance);
            }
        }

        function updateStatistics(key, finger) {
            keysPracticed++;
            correctKeys++;
            localStorage.setItem('keysPracticed', keysPracticed);
            localStorage.setItem('correctKeys', correctKeys);
            
            updateStats();
        }

        function updateStats() {
            document.getElementById('keysPracticed').textContent = keysPracticed;
            const accuracy = keysPracticed > 0 ? Math.round((correctKeys / keysPracticed) * 100) : 0;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
        }

        function updateSessionTime() {
            const now = new Date();
            const diff = Math.floor((now - sessionStartTime) / 1000);
            const minutes = Math.floor(diff / 60);
            const seconds = diff % 60;
            document.getElementById('sessionTime').textContent = 
                `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function resetStats() {
            keysPracticed = 0;
            correctKeys = 0;
            sessionStartTime = new Date();
            localStorage.setItem('keysPracticed', '0');
            localStorage.setItem('correctKeys', '0');
            updateStats();
            if (voiceEnabled) {
                speakText("Statistics reset");
            }
        }

        function speakInstructions() {
            const instructions = "This is the Complete Keyboard Typing Tutor. Click any key or type on your keyboard to hear which finger to use. Colors show finger assignments: red for pinky, orange for ring, yellow for middle, green for left index, teal for right index, purple for thumb. Practice all keys including numbers, Enter, Backspace, and Space.";
            document.getElementById('feedbackText').textContent = instructions;
            if (voiceEnabled) {
                speakText(instructions);
            }
        }

        function speakWelcome() {
            setTimeout(() => {
                const welcome = "Welcome to the Accessible Typing Tutor. This app is designed for users with light sensitivity and low vision. Click any key to begin learning the complete keyboard including numbers and special keys.";
                document.getElementById('feedbackText').textContent = welcome;
                if (voiceEnabled) {
                    speakText(welcome);
                }
            }, 1000);
        }

        function increaseFontSize() {
            baseFontSize = Math.min(36, baseFontSize + 2);
            updateFontSize();
        }

        function decreaseFontSize() {
            baseFontSize = Math.max(16, baseFontSize - 2);
            updateFontSize();
        }

        function updateFontSize() {
            document.documentElement.style.setProperty('--base-font-size', `${baseFontSize}px`);
            document.getElementById('currentFontSize').textContent = `${baseFontSize}px`;
            localStorage.setItem('baseFontSize', baseFontSize);
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            localStorage.setItem('voiceEnabled', voiceEnabled);
            document.getElementById('feedbackText').textContent = 
                `Voice feedback ${voiceEnabled ? 'enabled' : 'disabled'}`;
            if (voiceEnabled) {
                speakText(`Voice feedback enabled`);
            }
        }

        function toggleHighContrast() {
            highContrast = !highContrast;
            localStorage.setItem('highContrast', highContrast);
            
            if (highContrast) {
                document.documentElement.style.setProperty('--bg-color', '#000000');
                document.documentElement.style.setProperty('--container-bg', '#000000');
                document.documentElement.style.setProperty('--text-color', '#FFFFFF');
                document.documentElement.style.setProperty('--accent-color', '#FFFF00');
                document.documentElement.style.setProperty('--border-color', '#FFFFFF');
                document.documentElement.style.setProperty('--button-bg', '#000000');
                document.documentElement.style.setProperty('--button-hover', '#333333');
                document.documentElement.style.setProperty('--focus-color', '#FFFF00');
            } else {
                document.documentElement.style.setProperty('--bg-color', '#000000');
                document.documentElement.style.setProperty('--container-bg', '#222222');
                document.documentElement.style.setProperty('--text-color', '#FFFFFF');
                document.documentElement.style.setProperty('--accent-color', '#FFA500');
                document.documentElement.style.setProperty('--border-color', '#444444');
                document.documentElement.style.setProperty('--button-bg', '#333333');
                document.documentElement.style.setProperty('--button-hover', '#444444');
                document.documentElement.style.setProperty('--focus-color', '#FFFF00');
            }
            
            document.getElementById('feedbackText').textContent = 
                `High contrast mode ${highContrast ? 'enabled' : 'disabled'}`;
            if (voiceEnabled) {
                speakText(`High contrast mode ${highContrast ? 'enabled' : 'disabled'}`);
            }
        }

        function applyStoredSettings() {
            updateFontSize();
            if (highContrast) {
                toggleHighContrast(); // This will apply the high contrast theme
            }
        }
    </script>
</body>
</html>
